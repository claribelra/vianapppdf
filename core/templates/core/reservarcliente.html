{% extends 'core/base.html' %}
{% block title %}Reservar cupo | VianApp{% endblock %}
{% block content %}
<!-- Contenedor general con Grid -->
<div class="layout-container">
    
    <!-- Información del parqueadero -->
    <div class="info-card card shadow-sm">
        <div class="card-body">
            <h4 class="card-title mb-3" style="color:#2196f3;font-weight:800;letter-spacing:1px;">
                <i class="fas fa-parking"></i> Información del parqueadero
            </h4>
            <div class="d-flex align-items-center mb-3">
                <img src="{{ parqueadero.foto_dueno.url }}" alt="Foto dueño" 
                     class="img-fluid rounded" 
                     style="max-height:90px;object-fit:cover;border-radius:12px;box-shadow:0 2px 8px rgba(33,150,243,0.10);margin-right:18px;">
                <div>
                    <span class="badge bg-success mb-2" style="font-size:1.1rem;padding:8px 18px;border-radius:12px;">
                        {{ parqueadero.nombre_comercial }}
                    </span>
                </div>
            </div>
            <ul class="list-group list-group-flush mb-3" style="background:transparent;">
                <li class="list-group-item" style="background:transparent;border:none;padding-left:0;font-size:1.08rem;">
                    <i class="fas fa-map-marker-alt" style="color:#2196f3;"></i> 
                    <strong>Dirección:</strong> {{ parqueadero.direccion }}
                </li>
                <li class="list-group-item" style="background:transparent;border:none;padding-left:0;font-size:1.08rem;">
                    <i class="fas fa-city" style="color:#43a047;"></i> 
                    <strong>Ciudad:</strong> {{ parqueadero.ciudad|default:"No disponible" }}
                </li>
                <li class="list-group-item" style="background:transparent;border:none;padding-left:0;font-size:1.08rem;">
                    <i class="fas fa-car-side" style="color:#2196f3;"></i> 
                    <strong>Espacios disponibles:</strong> {{ parqueadero.espacios }}
                </li>
                <li class="list-group-item" style="background:transparent;border:none;padding-left:0;font-size:1.08rem;">
                    <i class="fas fa-file-alt" style="color:#43a047;"></i> 
                    <strong>Políticas:</strong> {{ parqueadero.politicas|default:"No disponible" }}
                </li>
            </ul>
        </div>
    </div>

    <!-- Formulario de reserva -->
    <div class="card shadow-sm reserva-card">
        <div class="card-body">
            <h4 class="card-title mb-3" style="color:#43a047;font-weight:800;letter-spacing:1px;">
                <i class="fas fa-user-check"></i> Reservar cupo
            </h4>
            <form id="reservaForm" method="post" autocomplete="off">
                {% csrf_token %}
                <div class="mb-2">
                    <input type="text" class="form-control" name="nombre" placeholder="Nombre completo" required style="border-radius:10px;">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" name="cedula" placeholder="Número de cédula" required style="border-radius:10px;">
                </div>
                <div class="mb-2">
                    <input type="tel" class="form-control" name="telefono" placeholder="Teléfono de contacto" required style="border-radius:10px;">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" name="placa" placeholder="Placa del vehículo" required style="border-radius:10px;">
                </div>
                <div class="mb-2">
                    <select class="form-control" name="tipo_vehiculo" required style="border-radius:10px;">
                        <option value="">Tipo de vehículo</option>
                        <option value="Carro">Carro</option>
                        <option value="Moto">Moto</option>
                        <option value="Bicicleta">Bicicleta</option>
                    </select>
                </div>
                <div class="mb-2">
                    <input type="datetime-local" class="form-control" name="fecha_hora" required style="border-radius:10px;">
                </div>
                <button type="submit" class="btn btn-success btn-sm w-100" 
                        style="font-weight:700;letter-spacing:1px;border-radius:10px;box-shadow:0 2px 8px #43a04733;">
                    <i class="fas fa-calendar-check"></i> Reservar ahora
                </button>
            </form>
        </div>
    </div>

    <!-- Valoraciones -->
    <div class="card shadow-sm valoracion-card">
        <div class="card-body text-center">
            <h4 class="card-title mb-3" style="color:#FFD700;font-weight:800;letter-spacing:1px;">
                <i class="fas fa-star"></i> Valora el parqueadero
            </h4>
            <img src="{{ parqueadero.foto_parqueadero.url }}" alt="Foto parqueadero" 
                 class="img-fluid rounded mb-3" 
                 style="max-height:120px;object-fit:cover;border-radius:12px;box-shadow:0 2px 8px rgba(255,193,7,0.10);">
            {% if puede_valorar %}
            <form method="post" autocomplete="off" style="margin-bottom:18px;">
                {% csrf_token %}
                <div class="mb-2">
                    <label for="id_rating" style="font-weight:600;">Calificación:</label>
                    {{ form_valoracion.rating }}
                </div>
                <div class="mb-2">
                    {{ form_valoracion.comentario }}
                </div>
                <button type="submit" name="enviar_valoracion" class="btn btn-warning btn-sm w-100" 
                        style="font-weight:700;letter-spacing:1px;border-radius:10px;box-shadow:0 2px 8px #FFD70033;">
                    <i class="fas fa-paper-plane"></i> Enviar valoración
                </button>
            </form>
            {% else %}
                <div class="alert alert-info" style="border-radius:10px;">Ya has dejado el máximo de 2 valoraciones para este parqueadero.</div>
            {% endif %}
            <hr>
            <h5 class="mt-3" style="color:#2196f3;font-weight:700;">Comentarios recientes</h5>
            <div id="commentsList" style="max-height:180px;overflow-y:auto;text-align:left;">
                {% for v in valoraciones_parqueadero %}
                    <div class='mb-2'>
                        <span style='color:#FFD700;font-size:1.2rem;'>
                            {% for i in "12345"|slice:":v.rating" %}&#9733;{% endfor %}{% for i in "12345"|slice:"v.rating:" %}&#9734;{% endfor %}
                        </span>
                        <span style='font-size:1.05rem;'>{{ v.comentario|linebreaksbr }}</span>
                        <span style='font-size:0.95rem;color:#888;'> — {{ v.usuario.username }}</span>
                    </div>
                {% empty %}
                    <div class="text-muted">Aún no hay valoraciones para este parqueadero.</div>
                {% endfor %}
            </div>
        </div>
    </div>

</div>

<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<!-- Estilos -->
<style>
.layout-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-areas: 
        "info reserva"
        "valoracion valoracion";
    gap: 30px;
    max-width: 1100px;
    margin: 90px auto 40px;
    padding: 0 15px;
}

/* Colores y bordes */
.info-card { 
    grid-area: info; 
    border-radius: 18px; 
    background: linear-gradient(135deg,#eaf1fb,#fff); 
    border: 3px solid #2196f3;
}
.reserva-card { 
    grid-area: reserva; 
    border-radius: 18px; 
    background: linear-gradient(135deg,#e3f9e5,#fff); 
    border: 3px solid #43a047;
}
.valoracion-card { 
    grid-area: valoracion; 
    border-radius: 18px; 
    background: linear-gradient(135deg,#fffbe6,#fff); 
    border: 3px solid #b8860b; /* dorado oscuro */
}

/* === BORDES Y SOMBRAS DE COLOR (con hover) === */

/* Info (azul) */
.info-card {
  border: 3px solid #2196f3;
  box-shadow:
    0 0 0 3px rgba(33,150,243,0.12),   /* halo de color */
    0 10px 24px rgba(33,150,243,0.18); /* sombra drop */
  transition: box-shadow .2s ease, transform .2s ease;
}
.info-card:hover {
  box-shadow:
    0 0 0 3px rgba(33,150,243,0.18),
    0 14px 32px rgba(33,150,243,0.26);
  transform: translateY(-2px);
}

/* Reserva (verde) */
.reserva-card {
  border: 3px solid #43a047;
  box-shadow:
    0 0 0 3px rgba(67,160,71,0.12),
    0 10px 24px rgba(67,160,71,0.18);
  transition: box-shadow .2s ease, transform .2s ease;
}
.reserva-card:hover {
  box-shadow:
    0 0 0 3px rgba(67,160,71,0.18),
    0 14px 32px rgba(67,160,71,0.26);
  transform: translateY(-2px);
}

/* Valoración (dorado oscuro) */
.valoracion-card {
  border: 3px solid #b8860b; /* dorado oscuro */
  box-shadow:
    0 0 0 3px rgba(184,134,11,0.12),
    0 10px 24px rgba(184,134,11,0.20);
  transition: box-shadow .2s ease, transform .2s ease;
}
.valoracion-card:hover {
  box-shadow:
    0 0 0 3px rgba(184,134,11,0.18),
    0 14px 32px rgba(184,134,11,0.28);
  transform: translateY(-2px);
}

/* Opcional: mejorar el redondeado y evitar desbordes de imágenes */
.info-card,
.reserva-card,
.valoracion-card {
  border-radius: 18px;
  overflow: hidden; /* mantiene imágenes dentro del borde redondeado */
}

/* === RESPONSIVE (ya tienes uno; este es por si quieres un corte extra) === */
@media (max-width: 768px) {
  .layout-container {
    grid-template-columns: 1fr;
    grid-template-areas:
      "info"
      "reserva"
      "valoracion";
    gap: 20px;
    padding: 0 12px;
  }
}


/* Estrellas */
.star { font-size: 2rem; color: #ccc; }
.star.selected, .star:hover { color: #FFD700; }




/* Responsividad */
@media (max-width: 992px) {
    .layout-container {
        grid-template-columns: 1fr;
        grid-template-areas:
            "info"
            "reserva"
            "valoracion";
    }
}
</style>
{% endblock %}
